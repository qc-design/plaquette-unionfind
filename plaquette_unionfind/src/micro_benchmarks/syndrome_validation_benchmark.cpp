#include <benchmark/benchmark.h>

#include "DecodingGraph.hpp"
#include "UnionFindDecoder.hpp"
#include "Clusters.hpp"
#include "Utils.hpp"


// sudo cpupower frequency-set --governor performance
// ./mybench
// sudo cpupower frequency-set --governor powersave

using namespace Plaquette;

// clang++-11 -g -O3 -mavx2 -Wall -pedantic -I$GBENCH_DIR/include benchmark.cpp
// $GBENCH_DIR/lib/libbenchmark.a -pthread  -lrt -lm -o benchmark

void syndrome_validation_benchmark_0(benchmark::State &state) {

    size_t num_vertices = 120;
    std::vector<std::pair<size_t, size_t>> edges{
        std::make_pair<size_t, size_t>(0, 80),
        std::make_pair<size_t, size_t>(0, 1),
        std::make_pair<size_t, size_t>(1, 2),
        std::make_pair<size_t, size_t>(2, 3),
        std::make_pair<size_t, size_t>(3, 81),
        std::make_pair<size_t, size_t>(0, 4),
        std::make_pair<size_t, size_t>(1, 5),
        std::make_pair<size_t, size_t>(2, 6),
        std::make_pair<size_t, size_t>(3, 7),
        std::make_pair<size_t, size_t>(4, 82),
        std::make_pair<size_t, size_t>(4, 5),
        std::make_pair<size_t, size_t>(5, 6),
        std::make_pair<size_t, size_t>(6, 7),
        std::make_pair<size_t, size_t>(7, 83),
        std::make_pair<size_t, size_t>(4, 8),
        std::make_pair<size_t, size_t>(5, 9),
        std::make_pair<size_t, size_t>(6, 10),
        std::make_pair<size_t, size_t>(7, 11),
        std::make_pair<size_t, size_t>(8, 84),
        std::make_pair<size_t, size_t>(8, 9),
        std::make_pair<size_t, size_t>(9, 10),
        std::make_pair<size_t, size_t>(10, 11),
        std::make_pair<size_t, size_t>(11, 85),
        std::make_pair<size_t, size_t>(8, 12),
        std::make_pair<size_t, size_t>(9, 13),
        std::make_pair<size_t, size_t>(10, 14),
        std::make_pair<size_t, size_t>(11, 15),
        std::make_pair<size_t, size_t>(12, 86),
        std::make_pair<size_t, size_t>(12, 13),
        std::make_pair<size_t, size_t>(13, 14),
        std::make_pair<size_t, size_t>(14, 15),
        std::make_pair<size_t, size_t>(15, 87),
        std::make_pair<size_t, size_t>(12, 16),
        std::make_pair<size_t, size_t>(13, 17),
        std::make_pair<size_t, size_t>(14, 18),
        std::make_pair<size_t, size_t>(15, 19),
        std::make_pair<size_t, size_t>(16, 88),
        std::make_pair<size_t, size_t>(16, 17),
        std::make_pair<size_t, size_t>(17, 18),
        std::make_pair<size_t, size_t>(18, 19),
        std::make_pair<size_t, size_t>(19, 89),
        std::make_pair<size_t, size_t>(20, 90),
        std::make_pair<size_t, size_t>(20, 21),
        std::make_pair<size_t, size_t>(21, 22),
        std::make_pair<size_t, size_t>(22, 23),
        std::make_pair<size_t, size_t>(23, 91),
        std::make_pair<size_t, size_t>(20, 24),
        std::make_pair<size_t, size_t>(21, 25),
        std::make_pair<size_t, size_t>(22, 26),
        std::make_pair<size_t, size_t>(23, 27),
        std::make_pair<size_t, size_t>(24, 92),
        std::make_pair<size_t, size_t>(24, 25),
        std::make_pair<size_t, size_t>(25, 26),
        std::make_pair<size_t, size_t>(26, 27),
        std::make_pair<size_t, size_t>(27, 93),
        std::make_pair<size_t, size_t>(24, 28),
        std::make_pair<size_t, size_t>(25, 29),
        std::make_pair<size_t, size_t>(26, 30),
        std::make_pair<size_t, size_t>(27, 31),
        std::make_pair<size_t, size_t>(28, 94),
        std::make_pair<size_t, size_t>(28, 29),
        std::make_pair<size_t, size_t>(29, 30),
        std::make_pair<size_t, size_t>(30, 31),
        std::make_pair<size_t, size_t>(31, 95),
        std::make_pair<size_t, size_t>(28, 32),
        std::make_pair<size_t, size_t>(29, 33),
        std::make_pair<size_t, size_t>(30, 34),
        std::make_pair<size_t, size_t>(31, 35),
        std::make_pair<size_t, size_t>(32, 96),
        std::make_pair<size_t, size_t>(32, 33),
        std::make_pair<size_t, size_t>(33, 34),
        std::make_pair<size_t, size_t>(34, 35),
        std::make_pair<size_t, size_t>(35, 97),
        std::make_pair<size_t, size_t>(32, 36),
        std::make_pair<size_t, size_t>(33, 37),
        std::make_pair<size_t, size_t>(34, 38),
        std::make_pair<size_t, size_t>(35, 39),
        std::make_pair<size_t, size_t>(36, 98),
        std::make_pair<size_t, size_t>(36, 37),
        std::make_pair<size_t, size_t>(37, 38),
        std::make_pair<size_t, size_t>(38, 39),
        std::make_pair<size_t, size_t>(39, 99),
        std::make_pair<size_t, size_t>(40, 100),
        std::make_pair<size_t, size_t>(40, 41),
        std::make_pair<size_t, size_t>(41, 42),
        std::make_pair<size_t, size_t>(42, 43),
        std::make_pair<size_t, size_t>(43, 101),
        std::make_pair<size_t, size_t>(40, 44),
        std::make_pair<size_t, size_t>(41, 45),
        std::make_pair<size_t, size_t>(42, 46),
        std::make_pair<size_t, size_t>(43, 47),
        std::make_pair<size_t, size_t>(44, 102),
        std::make_pair<size_t, size_t>(44, 45),
        std::make_pair<size_t, size_t>(45, 46),
        std::make_pair<size_t, size_t>(46, 47),
        std::make_pair<size_t, size_t>(47, 103),
        std::make_pair<size_t, size_t>(44, 48),
        std::make_pair<size_t, size_t>(45, 49),
        std::make_pair<size_t, size_t>(46, 50),
        std::make_pair<size_t, size_t>(47, 51),
        std::make_pair<size_t, size_t>(48, 104),
        std::make_pair<size_t, size_t>(48, 49),
        std::make_pair<size_t, size_t>(49, 50),
        std::make_pair<size_t, size_t>(50, 51),
        std::make_pair<size_t, size_t>(51, 105),
        std::make_pair<size_t, size_t>(48, 52),
        std::make_pair<size_t, size_t>(49, 53),
        std::make_pair<size_t, size_t>(50, 54),
        std::make_pair<size_t, size_t>(51, 55),
        std::make_pair<size_t, size_t>(52, 106),
        std::make_pair<size_t, size_t>(52, 53),
        std::make_pair<size_t, size_t>(53, 54),
        std::make_pair<size_t, size_t>(54, 55),
        std::make_pair<size_t, size_t>(55, 107),
        std::make_pair<size_t, size_t>(52, 56),
        std::make_pair<size_t, size_t>(53, 57),
        std::make_pair<size_t, size_t>(54, 58),
        std::make_pair<size_t, size_t>(55, 59),
        std::make_pair<size_t, size_t>(56, 108),
        std::make_pair<size_t, size_t>(56, 57),
        std::make_pair<size_t, size_t>(57, 58),
        std::make_pair<size_t, size_t>(58, 59),
        std::make_pair<size_t, size_t>(59, 109),
        std::make_pair<size_t, size_t>(60, 110),
        std::make_pair<size_t, size_t>(60, 61),
        std::make_pair<size_t, size_t>(61, 62),
        std::make_pair<size_t, size_t>(62, 63),
        std::make_pair<size_t, size_t>(63, 111),
        std::make_pair<size_t, size_t>(60, 64),
        std::make_pair<size_t, size_t>(61, 65),
        std::make_pair<size_t, size_t>(62, 66),
        std::make_pair<size_t, size_t>(63, 67),
        std::make_pair<size_t, size_t>(64, 112),
        std::make_pair<size_t, size_t>(64, 65),
        std::make_pair<size_t, size_t>(65, 66),
        std::make_pair<size_t, size_t>(66, 67),
        std::make_pair<size_t, size_t>(67, 113),
        std::make_pair<size_t, size_t>(64, 68),
        std::make_pair<size_t, size_t>(65, 69),
        std::make_pair<size_t, size_t>(66, 70),
        std::make_pair<size_t, size_t>(67, 71),
        std::make_pair<size_t, size_t>(68, 114),
        std::make_pair<size_t, size_t>(68, 69),
        std::make_pair<size_t, size_t>(69, 70),
        std::make_pair<size_t, size_t>(70, 71),
        std::make_pair<size_t, size_t>(71, 115),
        std::make_pair<size_t, size_t>(68, 72),
        std::make_pair<size_t, size_t>(69, 73),
        std::make_pair<size_t, size_t>(70, 74),
        std::make_pair<size_t, size_t>(71, 75),
        std::make_pair<size_t, size_t>(72, 116),
        std::make_pair<size_t, size_t>(72, 73),
        std::make_pair<size_t, size_t>(73, 74),
        std::make_pair<size_t, size_t>(74, 75),
        std::make_pair<size_t, size_t>(75, 117),
        std::make_pair<size_t, size_t>(72, 76),
        std::make_pair<size_t, size_t>(73, 77),
        std::make_pair<size_t, size_t>(74, 78),
        std::make_pair<size_t, size_t>(75, 79),
        std::make_pair<size_t, size_t>(76, 118),
        std::make_pair<size_t, size_t>(76, 77),
        std::make_pair<size_t, size_t>(77, 78),
        std::make_pair<size_t, size_t>(78, 79),
        std::make_pair<size_t, size_t>(79, 119),
        std::make_pair<size_t, size_t>(0, 20),
        std::make_pair<size_t, size_t>(1, 21),
        std::make_pair<size_t, size_t>(2, 22),
        std::make_pair<size_t, size_t>(3, 23),
        std::make_pair<size_t, size_t>(4, 24),
        std::make_pair<size_t, size_t>(5, 25),
        std::make_pair<size_t, size_t>(6, 26),
        std::make_pair<size_t, size_t>(7, 27),
        std::make_pair<size_t, size_t>(8, 28),
        std::make_pair<size_t, size_t>(9, 29),
        std::make_pair<size_t, size_t>(10, 30),
        std::make_pair<size_t, size_t>(11, 31),
        std::make_pair<size_t, size_t>(12, 32),
        std::make_pair<size_t, size_t>(13, 33),
        std::make_pair<size_t, size_t>(14, 34),
        std::make_pair<size_t, size_t>(15, 35),
        std::make_pair<size_t, size_t>(16, 36),
        std::make_pair<size_t, size_t>(17, 37),
        std::make_pair<size_t, size_t>(18, 38),
        std::make_pair<size_t, size_t>(19, 39),
        std::make_pair<size_t, size_t>(20, 40),
        std::make_pair<size_t, size_t>(21, 41),
        std::make_pair<size_t, size_t>(22, 42),
        std::make_pair<size_t, size_t>(23, 43),
        std::make_pair<size_t, size_t>(24, 44),
        std::make_pair<size_t, size_t>(25, 45),
        std::make_pair<size_t, size_t>(26, 46),
        std::make_pair<size_t, size_t>(27, 47),
        std::make_pair<size_t, size_t>(28, 48),
        std::make_pair<size_t, size_t>(29, 49),
        std::make_pair<size_t, size_t>(30, 50),
        std::make_pair<size_t, size_t>(31, 51),
        std::make_pair<size_t, size_t>(32, 52),
        std::make_pair<size_t, size_t>(33, 53),
        std::make_pair<size_t, size_t>(34, 54),
        std::make_pair<size_t, size_t>(35, 55),
        std::make_pair<size_t, size_t>(36, 56),
        std::make_pair<size_t, size_t>(37, 57),
        std::make_pair<size_t, size_t>(38, 58),
        std::make_pair<size_t, size_t>(39, 59),
        std::make_pair<size_t, size_t>(40, 60),
        std::make_pair<size_t, size_t>(41, 61),
        std::make_pair<size_t, size_t>(42, 62),
        std::make_pair<size_t, size_t>(43, 63),
        std::make_pair<size_t, size_t>(44, 64),
        std::make_pair<size_t, size_t>(45, 65),
        std::make_pair<size_t, size_t>(46, 66),
        std::make_pair<size_t, size_t>(47, 67),
        std::make_pair<size_t, size_t>(48, 68),
        std::make_pair<size_t, size_t>(49, 69),
        std::make_pair<size_t, size_t>(50, 70),
        std::make_pair<size_t, size_t>(51, 71),
        std::make_pair<size_t, size_t>(52, 72),
        std::make_pair<size_t, size_t>(53, 73),
        std::make_pair<size_t, size_t>(54, 74),
        std::make_pair<size_t, size_t>(55, 75),
        std::make_pair<size_t, size_t>(56, 76),
        std::make_pair<size_t, size_t>(57, 77),
        std::make_pair<size_t, size_t>(58, 78),
        std::make_pair<size_t, size_t>(59, 79)};

    std::vector<bool> vertex_boundary{
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1};
    std::vector<bool> syndrome_component_0{
        0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0,
        0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    std::vector<bool> modified_erasure_check{
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
        1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0};
    DecodingGraph decoding_graph(num_vertices, edges, vertex_boundary);

  for (auto _ : state) {
    Decoders::UnionFindDecoder uf_decoder(decoding_graph);
    uf_decoder.SetSyndrome(syndrome_component_0);
    uf_decoder.SyndromeValidation();
  }
  
  state.SetItemsProcessed(state.iterations());
}

BENCHMARK(syndrome_validation_benchmark_0);

BENCHMARK_MAIN();
